(function(a){"use strict";function b(b,c){var d=arguments,e=b;b=d[0],c=d[1]|{},[].shift.apply(d),"undefined"==typeof b&&(b=e);var h,i=this.each(function(){var e=a(this);if(e.is("input")){var i=e.data("combotree"),j="object"==typeof b&&b;if(i){if(j)for(var k in j)j.hasOwnProperty(k)&&(i.options[k]=j[k])}else{var l=a.extend({},f,a.fn.combotree.defaults||{},e.data(),j);e.data("combotree",i=new g(this,l,c))}"string"==typeof b&&(h=i[b]instanceof Function?i[b].apply(i,d):i.options[b])}});return"undefined"!=typeof h?h:i}this.ui=this.ui||{};var c=this.util,d=(this.ui,this.version),e=(this.namespace+"-combotree-",{container:'<div class="btn-group lion-combotree bootstrap-select form-control"><div>',button:'<button class="btn  form-control dropdown-toggle"><span class="pull-left"></span><i class="caret"></i></button>',bodyTree:'<div class="content"><ul  class="ztree"></ul></div>'}),f={id:"",version:d,title:"请选择...",btnClass:"",setting:{view:{dblClickExpand:!1},data:{simpleData:{enable:!0}},callback:{}},height:"auto",width:"auto",singleSelect:!0,loadurl:"",datakey:"selectednodetid"},g=function(b,c,d){this.options=c,this.$element=a(b),this.id=this.$element.attr("id"),this.$element.hide(),this.$newElement=null,this.$button=null,this.$content=null,this.$treeNodes=null,this.$tree=null,this.$treeObj=null,this.init(),this.focusoutListener()};g.version=f.version,g.prototype={constructor:g,init:function(){this.$newElement=this.buildView(),this.$element.after(this.$newElement),this.$content=this.$newElement.find(".content"),this.layout(),this.clickListener(),this.setTitle(),this.loadData(),this.setTree(),this.defalutVal()},buildView:function(){var b=this.options.btnClass,c=a(e.container),d=this.$element.parents().hasClass("form-group-lg")?" btn-lg":this.$element.parents().hasClass("form-group-sm")?" btn-sm":"";return c.hasClass(d)||c.addClass(d),c.append(e.button),this.$button=c.find("button"),b&&!this.$button.hasClass(b)&&this.$button.addClass(b),this.$button.attr("id","btn"+this.id),c.append(e.bodyTree),this.$tree=a(c.find("ul")),this.$tree.attr("btn","btn"+this.id),this.$tree.attr("combotree",this.id),this.$tree.attr("id","tree"+this.id),c},setTitle:function(){var a=this.$element.attr("placeholder")||this.options.title;this.$button.find("span").text(a)},clickListener:function(){var a=this.$button,b=this;a.click(function(a){b.show(),a.preventDefault()})},focusoutListener:function(){var a=this;this.$content.on("focusout","li a",function(b){a.$element.trigger("focusout")})},show:function(){this.$content.slideDown("fast")},hide:function(){this.$content.fadeOut("fast")},defalutVal:function(){var a=this.$element.val(),b="";c.isNotEmpty(a)&&(b=this.val(a)),c.isEmpty(b)&&this.setTitle()},val:function(a){if(null!==this.$treeObj){if(c.isEmpty(a)){for(var b="",d="",e=this.$treeObj.getSelectedNodes(),f=0,g=e.length;g>f;f++)d+=e[f].name+",",b=e[f].id;return b}var h=this.$treeObj.getNodeByParam("id",a);h&&(this.$treeObj.selectNode(h,!0),this.$newElement.find(".btn span").text(h.name),this.$element.val(h.id))}},refresh:function(){this.loadData(),this.setTree(),this.defalutVal()},loadData:function(){function a(a){e.$treeNodes=a}function b(a,b,c){}var d=this.options.loadurl,e=this;c.isEmpty(d)||c.postasync(d,"",a,b)},setTree:function(){var b=this.$tree,c=this.options.setting,d=this.$treeNodes,e=this;c.callback={beforeClick:e.treeBeforeClick,onClick:e.treeOnClick},a.fn.zTree.init(b,c,d);var f=this.$tree.attr("id");this.$treeObj=a.fn.zTree.getZTreeObj(f)},treeOnClick:function(b,c,d){var e=a.fn.zTree.getZTreeObj(c);if(e){var f=a("#"+c),g=f.attr("combotree"),h=f.attr("btn"),i=a("#"+h),j=a("#"+g),k=e.getSelectedNodes(),l="",m="";k.sort(function(a,b){return a.id-b.id});for(var n=0,o=k.length;o>n;n++)l+=k[n].name+",",m=k[n].id;l.length>0&&(l=l.substring(0,l.length-1)),i.find("span").text(l),j.val(m)}},treeBeforeClick:function(b,c){var d=a("#"+b),e=d.attr("combotree"),f=d.attr("btn"),g=a("#"+f),h=a("#"+e),i=c.tId||"",j=g.attr("selectedTid")||"0";if(i===j){var k=a.fn.zTree.getZTreeObj(b);return k.cancelSelectedNode(c),g.attr("selectedTid","0"),g.find("span").html(h.attr("placeholder")),h.val(""),!1}g.attr("selectedTid",i)},layout:function(){var b=this,c=(this.$element.offset(),this.options.height||this.$button.outerHeight()),d=(this.$newElement.offset(),this.options.width||this.$element[0].offsetWidth);this.$newElement.css({top:"0px",width:d,height:this.$button.outerHeight(),position:"absolute","z-index":"10000"});var e=this.$button.outerHeight();this.$content.outerWidth()>this.$button.outerWidth()&&(d=this.$content.outerWidth()),this.$content.css({top:e,width:d,height:c,"z-index":"15000",position:"absolute"}),a(window).resize(function(){}),a(window).on("scroll",function(){}),a("html").on("click",function(c){a(c.target).closest(b.$newElement).length<1&&b.hide()})}};var h=a.fn.combotree;a.fn.combotree=b,a.fn.combotree.Constructor=g,a.fn.combotree.noConflict=function(){return a.fn.combotree=h,this},a(function(){a(".lion-combotree").each(function(){var c=a(this);b.call(c,c.data())})})}).call(lion,jQuery);
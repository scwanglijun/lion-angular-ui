(function($){"use strict";function Plugin(a,b){var c=arguments,d=a;a=c[0],b=c[1]|{},[].shift.apply(c),"undefined"==typeof a&&(a=d);var e,f=this.each(function(){var d=$(this);if(d.is("table")){var f=d.data("datagrids"),g="object"==typeof a&&a;if(f){if(g)for(var h in g)g.hasOwnProperty(h)&&(f.options[h]=g[h])}else{var i=$.extend({},defaults,$.fn.datagrids.defaults||{},d.data(),g);d.data("datagrids",f=new Datagrids(this,i,b))}"string"==typeof a&&(e=f[a]instanceof Function?f[a].apply(f,c):f.options[a])}});return"undefined"!=typeof e?e:f}this.ui=this.ui||{};var util=this.util,exports=this.ui,_version=this.version,_id=0,_catchPrefix="ui-datagrids-",_idPrefix=this.namespace+"-datagrids-",events={},templates={checkboxs:'<input type="checkbox" class="checkboxes"/>'},defaults={id:"",singleselect:!1,lengthchange:!1,searching:!1,querydata:{},processing:!0,serverside:!0,statesave:!0,scrolly:"",scrollx:!1,jqueryui:!1,scrollcollapse:!1,sort:!0,order:[],deferRender:!0,pagelist:[[5,10,15,20],[5,10,15,20]],pagesize:10,columnDefs:[{bSortable:!1,aTargets:[0]}],loadurl:"",loading:!0,checkbox:!1,paginate:!0,language:{aria:{sortAscending:":",sortDescending:":"},emptyTable:"无记录",info:"从 _START_ 到 _END_ / 共 _TOTAL_ 条数据",infoEmpty:"无记录",infoFiltered:"(从 _MAX_ 条记录过滤)",lengthMenu:"每页显示 _MENU_ 条数据",search:"查找:",sProcessing:"数据加载中...",zeroRecords:"没有找到"},column:{field:"",formatter:"",sortable:!0,sortDir:"acs",checkbox:!1}},Datagrids=function(a,b,c){this.options=b,this.$element=$(a),this.id=this.$element.attr("id"),this.options.id=this.id,this.$odatatale=null,this.headerCols=null,this.osettings=null,this.rows=null,this.singleselect=this.options.singleselect,this.selectedrow=null,this.sorttargets=[],this.init()};Datagrids.version=_version,Datagrids.prototype={constructor:Datagrids,init:function(){this.loadTableClass(),this.$odatatale=this.buildTable(),this.osettings=this.settings(),this.initComplete()},queryparams:function(a){return util.isEmpty(a)?this.options.querydata:void(this.options.querydata=a)},querydata:function(){return this.options.querydata},loadTableClass:function(){$.extend(!0,$.fn.DataTable.TableTools.classes,{container:"btn-group tabletools-dropdown-on-portlet",buttons:{normal:"btn btn-sm default",disabled:"btn btn-sm default disabled"},collection:{container:"DTTT_dropdown dropdown-menu tabletools-dropdown-menu"}})},columnDefs:function(){var a=[{sDefaultContent:"",aTargets:"_all"}],b={};return this.sorttargets.length>0?(b.bSortable=!1,b.aTargets=this.sorttargets,a.push(b)):a=[{bSortable:!1,aTargets:[0]},{sDefaultContent:"",aTargets:"_all"}],a},columns:function(){var cols=[],headers=this.buildHeader(),that=this,firstSortable=-1,firstSortDir="asc";return $.each(headers,function(key,item){var col={};if(col.data=item.field,item.checkbox?col.render=function(a,b,c){return that.sorttargets.push(key),'<input type="checkbox" class="checkboxes" value="'+a+'"/>'}:item.sortable||that.sorttargets.push(key),util.isNotEmpty(item.formatter)&&!item.checkbox){var tempFn=eval(item.formatter);col.render=function(a,b,c){return tempFn.call(this,a,b,c)}}-1===firstSortable&&!item.checkbox&&item.sortable&&(firstSortable=key,firstSortDir="asc"===item.sortDir.toLowerCase()?"asc":"desc",that.options.order.push(firstSortable),that.options.order.push(firstSortDir)),cols.push(col)}),cols},buildHeader:function(){var a=this,b=[];return this.$element.find("thead th").each(function(){var c=$(this),d=c.data(),e=$.extend({},a.options.column,d);b.push(e)}),b},orders:function(){if(0===this.options.order.length)return[[1,"asc"]];var a=[];return a.push(this.options.order),a},buildTable:function(){var a=this,b={language:a.options.language,columns:a.columns(),ajaxSource:a.options.loadurl,columnDefs:a.columnDefs(),bLengthChange:a.options.lengthchange,searching:a.options.searching,processing:a.options.processing,serverSide:a.options.serverside,bStateSave:a.options.statesave,order:a.orders(),deferRender:a.options.deferRender,lengthMenu:a.options.pagelist,pageLength:a.options.pagesize,bAutoWidth:!1,bPaginate:a.options.paginate,fnInitComplete:function(){a.loadinitComplete(),a.initComplete()},fnDrawCallback:function(){a.drawCallback()},fnServerData:function(b,c,d){a.loaddata(b,c,d)},createdRow:function(b,c,d){a.createdRow(b,c,d)}};a.options.sort||(b.bSort=a.options.sort),util.isNotEmpty(a.options.scrolly)&&(b.scrollY=a.options.scrolly,b.scrollCollapse=this.options.scrollcollapse,a.options.jqueryui===!0&&(b.jQueryUI=this.options.jqueryui));var c=this.$element.dataTable(b);return c},settings:function(){var a=this.$element.dataTable();return a.fnSettings()},getSelections:function(){var a=[],b=this.$element.dataTable();return this.$element.find("tbody tr").each(function(){var c=$(this).find("input[type=checkbox]:checked");if(c.size()>0){var d=b.fnGetData(this);a.push(d)}}),a},getSelected:function(){return this.selectedrow?this.$element.dataTable().fnGetData(this.selectedrow):""},getdata:function(){var a=this.settings().aoData,b=[];return $.each(a,function(a,c){b.push(c._aData)}),b},drawCallback:function(){var a=this,b=a.$element,c=($("#"+this.id+"_wrapper"),b.find("tbody tr")),d=c.length;this.options.checkbox&&b.find("thead th input[type=checkbox]").each(function(){var a=$(this);a.removeAttr("checked"),a.parent("span").removeClass("checked")}),b.find("tbody tr input,textarea,select,button").uniform(),b.find("tbody tr td input[type=checkbox]").click(function(a){$(a.target).closest("tr").trigger("click")}),c.click(function(c){var e=$(this),f=e.find("input[type=checkbox]");if(a.selectedrow=this,a.options.singleselect===!0&&b.find("tbody tr td input[type=checkbox]").each(function(){var a=$(this);a.removeAttr("checked"),a.parent("span").removeClass("checked")}),f.attr("checked")?(f.removeAttr("checked"),f.parent("span").removeClass("checked"),e.removeClass("selected")):(f.attr("checked",!0),f.parent("span").addClass("checked"),e.addClass("selected")),a.options.checkbox){var g=b.find("tbody tr input[type=checkbox]:checked").length;g===d?b.find("thead th input[type=checkbox]").each(function(){var a=$(this);a.attr("checked",!0),a.parent("span").addClass("checked")}):b.find("thead th input[type=checkbox]").each(function(){var a=$(this);a.removeAttr("checked"),a.parent("span").removeClass("checked")})}});var e=$.Event("datagrids.reload");this.$element.trigger(e),e.isDefaultPrevented()},initComplete:function(){var a=$.Event("datagrids.initcomplete");this.$element.trigger(a),a.isDefaultPrevented()},loadinitComplete:function(){var a=$("#"+this.id+"_wrapper"),b=this,c=a;return a.find("th input,textarea,select,button").uniform(),a.find(".dataTables_scrollHead table").each(function(){$(this).css({width:b.$element.attr("width")})}),this.options.singleselect===!0&&this.options.checkbox?void c.find("thead th input[type=checkbox]").each(function(){$(this).attr("disabled",!0)}):void(this.options.checkbox&&c.find("thead th input[type=checkbox]").click(function(a){var b=c.find("tbody tr input[type=checkbox]:checked"),d=c.find("tbody tr input[type=checkbox]"),e=$(this);!e.attr("checked")&&b.size()>0&&b.size()==d.size()?c.find("tbody tr").each(function(){var a=$(this),b=a.find("input[type=checkbox]");b.removeAttr("checked"),b.parent("span").removeClass("checked")}):(c.find("tbody tr").each(function(){var a=$(this),b=a.find("input[type=checkbox]");b.attr("checked",!0),b.parent("span").addClass("checked")}),e.attr("checked",!0),e.parent("span").addClass("checked")),event.stopPropagation()}))},checkselected:function(){var a=this.$element,b=a.find("tbody tr").length,c=a.find("tbody tr input[type=checkbox]:checked").length;c===b&&a.find("thead th input[type=checkbox]").each(function(){var a=$(this);a.attr("checked",!0),a.parent("span").addClass("checked")})},checkboxdisabled:function(){var a=this.$element;a.find("input[type=checkbox]").each(function(){$(this).attr("disabled",!0)})},reload:function(){var a=this.$element.dataTable();a.fnDraw(this.settings()),this.options.singleselect||this.$element.find("thead th input[type=checkbox]:checked").each(function(){$(this).removeAttr("checked"),$(this).parent("span").removeClass("checked")});var b=$.Event("datagrids.reload");this.$element.trigger(b),b.isDefaultPrevented()},createdRow:function(a,b,c){var d=$.Event("datagrids.createdrow");this.$element.trigger(d,[a,b,c]),d.isDefaultPrevented()},loaddata:function(a,b,c){function d(a,b){c.call(this,a)}function e(a,b,c){console.dir(c),console.dir(b),h.css("display","none")}var f=this.params(b),g=this,h=(this.$element,$("#"+g.id+"_processing"));if(!this.options.loading){var i={draw:f.requestId,recordsFiltered:0,recordsTotal:0,total:0,data:{}};return this.options.loading=!0,void c.call(this,i)}util.post(a,f,d,e)},params:function(a){var b={},c=[],d=[],e={},f={},g="",h="",i="",j="",k="",l=-1,m="",n="";if($.each(a,function(a,o){var p="",q="",r="";$.each(o,function(a,b){"name"===a?"sEcho"===b?q="requestId":"iDisplayStart"===b?q="page":"iDisplayLength"===b?q="rows":"iColumns"===b?q="columnSize":"iSortingCols"===b?q="sortingCols":b.indexOf("mDataProp")>-1?(g="column",r=g):b.indexOf("bSortable")>-1?(i="sortable",r=i):b.indexOf("iSortCol")>-1?(k="sortCol",r=k):b.indexOf("sSortDir")>-1&&(m="dir",r=m):"value"===a&&util.isEmpty(r)?p=b:"value"===a&&"column"===r?h=b:"value"===a&&"sortable"===r?j=b:"value"===a&&"sortCol"===r?l=b:"value"===a&&"dir"===r&&(n=b)}),util.isNotEmpty(g)&&util.isNotEmpty(h)&&util.isNotEmpty(i)&&util.isNotEmpty(j)&&(e[g]=h,e[i]=j,c.push(e),g="",h="",i="",j="",e={}),util.isNotEmpty(k)&&util.isNotEmpty(l)&&util.isNotEmpty(m)&&util.isNotEmpty(n)&&(f[k]=l,f[m]=n,d.push(f),k="",l="",m="",l="",f={}),util.isNotEmpty(q)&&(b[q]=p,p="")}),1==d.length){var o=d[0],p="order",q=o.sortCol,r="";k="sort";for(var s=0;s<c.length;s++)if(s===q){r=c[s].column;break}b[k]=r,b[p]=o.dir}return $.each(this.options.querydata,function(a,c){b[a]=c}),b}};var old=$.fn.datagrids;$.fn.datagrids=Plugin,$.fn.datagrids.Constructor=Datagrids,$.fn.datagrids.noConflict=function(){return $.fn.datagrids=old,this},$(function(){$(".lion-datagrids").each(function(){var a=$(this);Plugin.call(a,a.data())})})}).call(lion,jQuery);
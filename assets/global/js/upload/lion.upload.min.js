!function(a){"use strict";jQuery.fn.extend({uploadPreview:function(b){var c=this;c.IsNull=function(a){return void 0===a||null===a||""===a||0===a.length?!0:!1},c.DefautlSetting={DivShow:"",ImgShow:"imgShow",ImgType:["gif","jpeg","jpg","bmp","png"],ErrMsg:"选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种",callback:function(){}},c.getObjectURL=function(a){var b=null;return void 0!=window.createObjectURL?b=window.createObjectURL(a):void 0!=window.URL?b=window.URL.createObjectURL(a):void 0!=window.webkitURL&&(b=window.webkitURL.createObjectURL(a)),b},c.paint=function(b){function c(b){if(a("#w").attr("value",Math.round(b.w)),a("#h").attr("value",Math.round(b.h)),a("#x").attr("value",Math.round(b.x)),a("#y").attr("value",Math.round(b.y)),parseInt(b.w)>0){var c=j/b.w,d=k/b.h;i.css({width:Math.round(c*e)+"px",height:Math.round(d*f)+"px",marginLeft:"-"+Math.round(c*b.x)+"px",marginTop:"-"+Math.round(d*b.y)+"px"})}}var d,e,f,g=a("#preview-pane"),h=a("#preview-pane .preview-container"),i=a("#preview-pane .preview-container img"),j=h.width(),k=h.height();i.attr("src",b.attr("src")),b.Jcrop({onChange:c,onSelect:c,aspectRatio:1},function(){var a=this.getBounds();e=a[0],f=a[1],d=this,g.appendTo(d.ui.holder)})},c.change(function(){var d=a("#"+b.DivShow),e=c.IsNull(d.find("img").eq(0).attr("id"))?c.DefautlSetting.ImgShow:d.find("img").eq(0).attr("id"),f=c.IsNull(b.Width)?d.width():b.Width,g=c.IsNull(b.Height)?d.height():b.Height,h=c.IsNull(b.ImgType)?c.DefautlSetting.ImgType:b.ImgType,i=(c.IsNull(b.ErrMsg)?c.DefautlSetting.ErrMsg:b.ErrMsg,c.IsNull(b.callback)?c.DefautlSetting.callback:b.callback);if(this.value){if(!RegExp(".("+h.join("|")+")$","i").test(this.value.toLowerCase()))return alert(c.Setting.ErrMsg),this.value="",!1;d.empty();var j='<img id="'+e+'" /><div id="preview-pane"><div class="preview-container"><img /></div></div>';j+='<input type="hidden" id="x" name="x"/>',j+='<input type="hidden" id="y" name="y"/>',j+='<input type="hidden" id="w" name="w"/>',j+='<input type="hidden" id="h" name="h"/>',d.html(j);var k=a("#"+e);k.width(f+"px"),k.height(g+"px"),k.attr("src",c.getObjectURL(this.files[0])),c.paint(k),i()}})}})}(jQuery);